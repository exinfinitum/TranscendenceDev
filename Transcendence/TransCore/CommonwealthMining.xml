<?xml version="1.0" encoding="utf-8"?>

<TranscendenceModule>

	<!-- Mining Colony ===================================================== -->

	<StationType UNID="&stMiningColony;"
			name=				"Commonwealth mining colony"
			sovereign=			"&svCommonwealth;"
			inherit=			"&baCommonwealthStation;"
				 
			attributes=			"asteroidBase, commonwealth, commonwealthCustoms, envEarth, envAvoidsAir, friendly, generic, human, mining, populated"
				 
			dockScreen=			"Main"
			abandonedScreen=	"&dsRPGAbandonedStation;"

			size=				"300"
			armorID=			"&itPlasteelPlate;"
			hitPoints=			"100"
			multiHull=			"true"
			regen=				"1"
				 
			fireRateAdj=		"60"
				 
			explosionType=		"&vtKineticExplosion2;"
			ejectaType=			"&vtStoneAsteroidEjecta;"
			>
		
		<!-- Encounter Info -->
		
		<Encounter
				systemCriteria=			"+commonwealthSpace;"
				systemAffinity=			"*"
				levelFrequency=			"ccur- ----- ----- ----- -----"

				locationCriteria=		"+asteroids, -outerSystem"
				enemyExclusionRadius=	"60"
				/>

		<Names noArticle="true">Amundsen Mining Colony; Benin %1%0%0; Clementine Mining Association; Duralloy Dreams;
				EI Mining Colony %1%0; Freetown Mining; St. George's Colony; %1%0%0%0 Hades;
				Ibadan Mining; Jasper Mining; Kiloton Mining; Lusaka Mining Colony;
				Metals &amp; Ores Mining; New Johannesburg; Omdurman Mining; Port Harcourt;
				Qadarif Minerals; Ryad Mining Colony; %1%0%0%0 Sangre; Tangiers Metals;
				UN%0%0%0 Mining Colony; St. Victoria's Colony; %1%0%0%0 Welkom; X%0%0%0 Mining Colony;
				Yafran Colony; Zagazig Minerals</Names>

		<!-- Trade and Items -->
		
		<Trade currency="credit">
			<Sell	criteria="wNU +unid:&itMiningLaser;;" priceAdj="100"	inventoryAdj="100"/>
			<Sell	criteria="cNU +unid:&itMinersCargoHold;;" priceAdj="100"	inventoryAdj="100"/>
			<Sell	criteria="*NU +miningEquipment; -defective; -Illegal; -NotForSale; -notStandard;" priceAdj="100" inventoryAdj="100" levelFrequency="systemLevel:ru|c|cur"/>
			<Sell	criteria="*NU +Ore; -defective; -NotForSale;"	priceAdj="100"/>
			<Buy	criteria="*NU +Food; -Illegal; -NotForSale;"	priceAdj="100"/>
			
			<Refuel			criteria="f +BasicFuel; L:1-5;" priceAdj="100"/>
			<RepairArmor	criteria="a L:1-5;" priceAdj="100"/>
			<ReplaceArmor	criteria="a L:1-5;" priceAdj="100"/>
			<InstallDevice	criteria="d +miningEquipment; -Illegal; L:1-6;" priceAdj="50"/>
			<RemoveDevice	criteria="d L:1-6;" priceAdj="100"/>
			
			<InstallDevice	criteria="d L:1-6;" priceAdj="unavailable"	messageID="descNoInstall"/>

			<ConsumeTrade	criteria="{core.fusionFuel}"		impact="2"/>
			<ConsumeTrade	criteria="{human.basicFood}"	impact="3"/>
			<ConsumeTrade	criteria="{human.lux}"		impact="1"/>
			<ConsumeTrade	criteria="{human.meds}"		impact="2"/>
			<ConsumeTrade	criteria="{human.res}"		impact="1"/>

			<ProduceTrade	criteria="{core.ore}"			impact="20"/>
		</Trade>

		<Items>
			<RandomItem 
					criteria=		"* +Ore; -NotStandard; -NotForSale;"
					level=			"1"
					levelCurve=		"2"
					/>
		</Items>

		<!-- Configuration -->
		
		<Devices>
			<Device deviceID="&itParticleBeamWeapon;"	omnidirectional="true"/>
		</Devices>

		<!-- Satellites -->

		<!-- Ships and Defenses -->
		
		<Ships>
			<Lookup count="1" table="&tbCommDefenders;"/>
			<Lookup count="1d2" table="&tbCommPrivateCrafts;"/>
			<Ship count="1d2+1" class="&scBorer;" orders="gateOnThreat"/>
		</Ships>

		<Reinforcements minShips="5">
			<Table>
				<Lookup chance="50" table="&tbCommDefenders;"/>
				<Lookup chance="10" table="&tbCommPrivateCrafts;"/>
				<Ship chance="40" class="&scBorer;" orders="gateOnThreat"/>
			</Table>
		</Reinforcements>

		<!-- Image and Effects -->
		
		<ImageVariants>
			<LocationCriteriaTable>
				<Image criteria="*ice"			imageID="&rsMiningColonyIce;"			imageWidth="260" imageHeight="260"/>
				<Image criteria="*metallic"		imageID="&rsMiningColonyMetallic;"		imageWidth="260" imageHeight="260"/>
				<Image criteria="*primordial"	imageID="&rsMiningColonyPrimordial;"	imageWidth="260" imageHeight="260"/>
				<Image criteria="*volcanic"		imageID="&rsMiningColonyVolcanic;"		imageWidth="260" imageHeight="260"/>
				
				<Image criteria="*~"			imageID="&rsMiningColonyRocky;"			imageWidth="260" imageHeight="260"/>
			</LocationCriteriaTable>
		</ImageVariants>

		<DockingPorts
				portCount=		"9"
				portRadius=		"140"
				>
		</DockingPorts>
		
		<!-- Dock Screens -->
		
		<DockScreens>
			<Main>
				<Panes>
					<Default>
						<OnPaneInit>
							(block (
								(allDeposits (sysFindObject Nil "k D:oreDepositCount;"))
								(undiscoveredDeposits (filter allDeposits depositObj
									(not (objGetData depositObj 'lastNotifyTime))
									))
								)
								
								;	Text depends on state of deposits
								
								(switch
									(not allDeposits)
										(scrSetDescTranslate gScreen 'descNoDepositsInSystem)
										
									(not undiscoveredDeposits)
										(scrSetDescTranslate gScreen 'descAllDepositsFound)
									
									(= (count undiscoveredDeposits) 1)
										(scrSetDescTranslate gScreen 'descOneUndiscoveredDeposit)
										
									(scrSetDescTranslate gScreen 'descMultipleUndiscoveredDeposits)
									)
								)
						</OnPaneInit>

						<Actions>
							<Action id="actionMainHall" default="1">
								(rpgMissionAssignment {
									missionCriteria: (cat "n +commonwealthMining; =" (sysGetLevel) ";")
									maxPerStation: (+ 1 (modulo (objGetDestiny gSource) 3))
									intervalPerStation: (+ 5400 (* (objGetDestiny gSource) 10))
									noMissionTextID: 'descNoMissions
									})
							</Action>

							<Action id="actionCommoditiesExchange">
								(scrShowScreen gScreen &dsRPGCommoditiesExchange;)
							</Action>

							<Action id="actionDockServices">
								(rpgDockServices gPlayerShip {
									checkMilitaryID: True
									})
							</Action>

							<Action id="actionUndock" cancel="1">
								<Exit/>
							</Action>
						</Actions>
					</Default>
				</Panes>
			</Main>

		</DockScreens>

		<!-- Events and Data -->
		
		<StaticData>
			<NPCService>
				(	;	service					level	margin
					(	'repairArmor			5		100		)
					)
			</NPCService>
		</StaticData>

		<Events>
			<OnCreate>
				;	Add ore to sell based on system ore frequency
				
				(sysAddRandomOreByValue gSource
					(@ 
						(list 0 
							2000 5000 10000 20000 50000 
							100000 200000 500000 1000000 2000000)
						(sysGetLevel)
						)
					)
			</OnCreate>
			
			<GetGlobalAchievements>
				(rpgMissionAchievements &stMiningColony; "* +commonwealthMining;")
			</GetGlobalAchievements>

			<GetRumors>
				(append
					(rpgRumorAdd 'commonwealthPub 1 20 'scan {station: (objGetName gSource)})

					(rpgRumorAdd 'commonwealthMining (make 'sequence 15))

					(if (= (objGetProperty gPlayerShip 'characterClass) &unidPilgrimClass;)
						(rpgRumorAdd 'commonwealthMining 'pilgrim)
						(rpgRumorAdd 'commonwealthMining 'freelancer)
						)
					)
			</GetRumors>

			<OnOreDepositFound>
				(switch
					;	If there are no outlaw miners in the system, we send out
					;	ships on their behalf.
					
					(not (sysFindObject Nil "T +outlawMiners; +populated;"))
						(block (minerObj)
							(setq minerObj (sysCreateShip &tbOutlawMinerProspector; (sysFindObject gSource "GN") &svOutlawMiners;))
							(objSetData minerObj 'depositID (objGetID (@ gData 'depositObj)))
							)
					)
			</OnOreDepositFound>
		</Events>

		<Language>
			<Text id="descNoDepositsInSystem">

				You are docked at a mining colony. A handful of miners tend to 
				their ships, but most are sitting around waiting for work that 
				never comes.
					
				Empty loading bays are a silent reminder of past days.

			</Text>
			<Text id="descAllDepositsFound">

				You are docked at a mining colony. Dozens of miners prepare their
				ships while others unload ore in cavernous bays.
					
				But the prospectors looking for undiscovered fields have all left
				for more promising systems.

			</Text>
			<Text id="descOneUndiscoveredDeposit">

				You are docked at a mining colony. Dozens of prospectors are 
				working to outfit their ships.
					
				Everyone is talking about a vast ore deposit that has yet to be 
				found.

			</Text>
			<Text id="descMultipleUndiscoveredDeposits">

				You are docked at a mining colony. There is a frenzy of activity 
				as miners and prospectors outfit their ships for deep space 
				exploration.
					
				Rumors fly about vast ore deposits out among the asteroid fields, 
				but no one has yet found any of them.

			</Text>
			<Text id="descNoMissions">

				The colony supervisor is working at his station. The comms channels
				are quiet and he stops to chat:

				"It's calm now, but I've been hearing a lot of military chatter lately."

			</Text>
			<Text id="descNoInstall">

				We only install mining equipment. We cannot install %itemName% 
				on your ship.

			</Text>
			<Text id="dockServices:installAbility">
				We install mining equipment up to tech level %maxLevel%.
			</Text>
			<Text id="dockServices:weaponsAbility">
				We sell mining equipment up to tech level %maxLevel%.
			</Text>

			<Text id="rumor.intro">
				The colony supervisor is working at his station. The comms channels
				are quiet and he stops to chat:\n\n
			</Text>

			<String id="rumor.commonwealthMining.1">

				"It's calm now, but I've been hearing a lot of military chatter lately."

			</String>
			<Text id="rumor.commonwealthMining.2">

				"Most people don't care where their metals come from, but let me
				tell you: plasteel doesn't grow in greenhouses! We have to struggle
				to mine enough for everyone."

			</Text>
			<Text id="rumor.commonwealthMining.3">

				"Charon pirates have always been a problem here. They're getting
				stronger every year. One of these days we're going to have to do
				something about them."

			</Text>
			<Text id="rumor.commonwealthMining.4">

				"The Korolov folks are good people; they're a little uptight about
				schedules and they're big on pomp and medals, but we get along pretty well."

			</Text>
			<Text id="rumor.commonwealthMining.5">

				"We've had a lot of trouble with the warlords. They come through
				in gangs and shoot up the place; they take what they need and then leave."

			</Text>
			<Text id="rumor.commonwealthMining.6">

				"I don't know much about weapons; not as much as you do, anyway.
				But I know a lot of people who favor the AK15 Partisan. Of course,
				if you can get your hands on a slam cannon, you're styling."

			</Text>
			<Text id="rumor.commonwealthMining.7">

				"Heavy metal armor is the best, in my opinion. Ceramic is nice for
				my dishes, but it will do kack-all against a slam cannon. Ithalium
				is the best; orthosteel is pretty awesome too. Duralloy lasts almost
				forever, though."

			</Text>
			<Text id="rumor.commonwealthMining.8">

				"Have you ever been to the Outer Realm? Out beyond the Sung Slavers,
				where the Ringers live? It's miner heaven, I bet. I'd like to go out
				there some day. Just me and a souped-up Borer. The Ferians are there
				too; I hear they've got mining techniques like you've never seen."

			</Text>
			<Text id="rumor.commonwealthMining.9">

				"It's not too dangerous from Eridani to St. Kat's. Mostly just pirates
				to worry about. But deeper in the Ungoverned Territories there are
				dangers that you cannot imagine. Slavers will jump you out in deep
				space and boost your body for their slave farms."

			</Text>
			<Text id="rumor.commonwealthMining.10">

				"The Charon pirates are nasty, but you can handle their gunships.
				Stay away from their frigates, though."

			</Text>
			<Text id="rumor.commonwealthMining.11">

				"When a Charon frigate is out hunting you'd best get away. They'll
				take you down fast without so much as a warning."

			</Text>
			<Text id="rumor.commonwealthMining.12">

				"Titanium ore is as common as suit-rash. Palladium and plasteel
				are kack too. If you want a good payday, find an asteroid with cerallox
				or helium regolith."

			</Text>
			<Text id="rumor.commonwealthMining.13">

				"Every chump with a mining laser thinks he can mine. But if you want
				to be a serious miner you need a miner's cargo hold."

			</Text>
			<Text id="rumor.commonwealthMining.14">

				"Volcanic asteroids are the best for mining. I once found 30 tons
				of ithalium ore on one! Kept me in vodka and cunnu for a couple of years!"

			</Text>
			<Text id="rumor.commonwealthMining.15">

				"Ice asteroids are filthy with cerallox. Lots of palladium and
				plasteel too, though, so they're not always worth the effort."

			</Text>
			<Text id="rumor.commonwealthMining.pilgrim">

				"So you're going to the Core, huh? Good luck with that! I've known
				a lot of people heading towards the Core. My best friend's wife left
				about a year ago. Can't say that anyone's ever returned, though."

			</Text>
			<Text id="rumor.commonwealthMining.freelancer">

				"So you're a freelancer, huh? Good luck with that! I've known
				a lot of freelancers and mercs. My best friend's husband was
				a freelancer for a while. Caught a missile out in Heilong Xing."

			</Text>

			<Text id="rumor.commonwealthPub.1">

				You talk to a group of miners from %station% who try to impress
				you with their knowledge of helium regolith market prices.
				You spend 5 credits on drinks.

			</Text>

			<Text id="rpg.missionTypeDesc">Mining colony missions</Text>
			<Text id="core.mapDesc">
				Refuels up to level 5 &mdash; Repairs/installs armor up to level 5 &mdash; Installs mining equipment up to level 6 &mdash; Sells ore &mdash; Buys food
			</Text>
		</Language>
	</StationType>
	
<!-- RESOURCES -->

	<Image UNID="&rsMiningColonyIce;"			bitmap="Resources\MiningColonyIce.jpg"	bitmask="Resources\MiningColonyIceMask.bmp" 	loadOnUse="true" />
	<Image UNID="&rsMiningColonyMetallic;"		bitmap="Resources\MiningColonyMetallic.jpg"	bitmask="Resources\MiningColonyMetallicMask.bmp" 	loadOnUse="true" />
	<Image UNID="&rsMiningColonyPrimordial;"	bitmap="Resources\MiningColonyPrimordial.jpg"	bitmask="Resources\MiningColonyPrimordialMask.bmp" 	loadOnUse="true" />
	<Image UNID="&rsMiningColonyRocky;"			bitmap="Resources\MiningColonyRocky.jpg"	bitmask="Resources\MiningColonyRockyMask.bmp" 	loadOnUse="true" />
	<Image UNID="&rsMiningColonyVolcanic;"		bitmap="Resources\MiningColonyVolcanic.jpg"	bitmask="Resources\MiningColonyVolcanicMask.bmp" 	loadOnUse="true" />

</TranscendenceModule>
